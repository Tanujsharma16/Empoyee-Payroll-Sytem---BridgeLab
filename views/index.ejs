<!DOCTYPE html>
<html>
<head>
    <title>Employee Payroll</title>
    <link rel="stylesheet" href="/style.css">

    <!-- ICONS -->
    <link rel="stylesheet"
     href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>

<div class="dashboard">

    <div class="header">
        <h2>Employee Details</h2>

        <div class="header-right">
            <input type="text" id="searchInput"
                   placeholder="Search employee..."
                   onkeyup="searchEmployee()">

            <a href="/add" class="add-btn">
                <i class="fa-solid fa-user-plus"></i> Add User
            </a>
        </div>
    </div>

    <!-- SUMMARY CARDS -->
    <div class="summary">

        <div class="card">
            <div class="icon-box"><i class="fa-solid fa-users"></i></div>
            <div>
                <p>Total Employees</p>
                <h3><%= employees.length %></h3>
            </div>
        </div>

        <div class="card">
            <div class="icon-box"><i class="fa-solid fa-building"></i></div>
            <div>
                <p>Departments</p>
                <h3><%= [...new Set(employees.map(e => e.position))].length %></h3>
            </div>
        </div>

        <div class="card">
            <div class="icon-box"><i class="fa-solid fa-indian-rupee-sign"></i></div>
            <div>
                <p>Total Salary</p>
                <h3>
                    ₹<%= employees.reduce((s,e)=> s + Number(e.salary || 0), 0).toLocaleString() %>
                </h3>
            </div>
        </div>

        <div class="card">
            <div class="icon-box"><i class="fa-solid fa-money-bill-wave"></i></div>
            <div>
                <p>Avg Salary</p>
                <h3>
                    ₹<%= employees.length
                    ? Math.round(
                        employees.reduce((s,e)=> s + Number(e.salary || 0), 0)
                        / employees.length
                      ).toLocaleString()
                    : 0 %>
                </h3>
            </div>
        </div>

    </div>

    <!-- TABLE -->
    <table>
        <tr>
            <th>Name</th>
            <th>Gender</th>
            <th>Department</th>
            <th>Salary</th>
            <th>Start Date</th>
            <th>Actions</th>
        </tr>

        <% employees.forEach(emp => { %>
        <tr>
            <td>
                <i class="fa-solid fa-circle-user avatar"></i>
                <%= emp.name %>
            </td>
            <td><%= emp.gender %></td>
            <td><%= emp.position %></td>

            <!--  SAFE SALARY -->
            <td>₹<%= Number(emp.salary || 0).toLocaleString() %></td>

            <td><%= emp.DateOfJoining %></td>
            <td>
                <a href="/edit/<%= emp.id %>" class="action-btn edit">
                    <i class="fa-solid fa-pen"></i>
                </a>
                <a href="/delete/<%= emp.id %>" class="action-btn delete">
                    <i class="fa-solid fa-trash"></i>
                </a>
            </td>
        </tr>
        <% }) %>
    </table>

</div>

<script>
function searchEmployee() {
    let input = document.getElementById("searchInput").value.toLowerCase();
    let rows = document.querySelectorAll("table tr");

    for (let i = 1; i < rows.length; i++) {
        let text = rows[i].innerText.toLowerCase();
        rows[i].style.display = text.includes(input) ? "" : "none";
    }
}
</script>

</body>
</html>